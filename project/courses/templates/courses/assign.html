{% extends 'courses/base.html' %}

{% load bootstrap3 %}

{% block main %}

{% bootstrap_messages %}

<form method="post">
{% csrf_token %}

{% for topic in data.topics %}
    <div class="panel panel-default ir-assignment">
        <div class="panel-heading">{{ topic.name }}</div>
        <ul class="list-group">
        {% for slot in topic.slots %}
            <li class="list-group-item{% if slot.is_penalty %} list-group-item-warning{% endif %}">
                {% bootstrap_form_errors slot.form %}
                <div class="row">
                    <div class="col-md-7">
                        <div class="form-group {%if slot.form.problem.errors %}has-error{%endif%}">
                            <div class="input-group">
                                {{ slot.form.problem }}
                                <div class="input-group-addon ir-icon-links">
                                    <a href="#" id="{{ slot.form.problem.auto_id }}-statement">{% bootstrap_icon 'film' %}</a>&nbsp;&nbsp;<a href="#" id="{{ slot.form.problem.auto_id }}-manage">{% bootstrap_icon 'pencil' %}</a>
                                </div>
                            </div>
                            {% if slot.form.problem.errors %}
                            {% for error in slot.form.problem.errors %}
                                <span class="help-block">{{ error }}</span>
                            {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-4">
                        {% bootstrap_field slot.form.criteria show_label=False %}
                        {% if slot.extra_requirements %}
                            {% bootstrap_field slot.form.extra_requirements_ok %}
                        {% endif %}
                    </div>
                    <div class="col-md-1">
                        <button class="btn btn-default" type="button" data-toggle="collapse" data-target="#{{ slot.form.problem.auto_id }}-collapse" aria-expanded="false" aria-controls="collapseExample">...</button>
                    </div>
                </div>
                <div class="collapse" id="{{ slot.form.problem.auto_id }}-collapse">
                    <div class="row">
                        <div class="col-md-7">
                            ddd
                        </div>
                        <div class="col-md-4">
                            {% bootstrap_field slot.form.extra_requirements show_label=False %}
                            {% if not slot.extra_requirements %}
                                {% bootstrap_field slot.form.extra_requirements_ok %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </li>
        {% endfor %}
        </ul>
    </div>
{% endfor %}

<div class="panel panel-default ir-assignment">
    <div class="panel-body">
        <button type="submit" class="btn btn-default">Submit</button>
    </div>
</div>

</form>

<div class="panel panel-success ir-assignment">
    <div class="panel-heading">Дополнительные задачи</div>
    <div class="panel-body">
        
    </div>
</div>

<div class="panel panel-warning ir-assignment">
    <div class="panel-heading">Штрафные задачи</div>
    <div class="panel-body">
        <form class="form-inline">
            <div class="form-group">
                {% bootstrap_field data.extra_form.penaltytopic %}
            </div>
            <button type="submit" class="btn btn-default">Добавить</button>
        </form>
    </div>
</div>


<script>
    function setLinks(select) {
        var id = select.attr('id');

        var statementUrl = "#";
        var manageUrl = "#";

        var selectedProblem = $("#" + id + " option:selected");
        if (selectedProblem) {
            var problemId = selectedProblem.val();
            if (problemId) {
                var topicID = select.data('topic');
                if (topicID) {
                    statementUrl = Urls["courses:course_problems_topic_problem"]({{ course.id }}, topicID, problemId);
                    manageUrl = Urls["problems:overview"](problemId);
                }
            }
        }

        $("#" + id + "-statement").attr("href", statementUrl);
        $("#" + id + "-manage").attr("href", manageUrl);
    }

    $(document).ready(function() {
        $("select.ir-choose-problem").change(function() {
            setLinks($(this));
        }).each(function() {
            setLinks($(this));
        });
    });
</script>

{% endblock %}
