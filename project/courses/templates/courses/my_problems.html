{% extends 'courses/base.html' %}

{% load bootstrap3 %}
{% load i18n %}
{% load irunner_courses %}
{% load irunner_solutions %}
{% load irunner_problems_complexity %}

{% block main %}

<table class="table ir-assignment">
    <tbody>
        {% for topic_result in user_result.topic_results %}
            {% with topic_result.get_slot_and_penalty_results as joint_results %}
                {% for slot_result in joint_results %}
                    <tr>
                        {% if forloop.first %}
                            <td rowspan="{{ joint_results|length }}" class="ir-topic">
                                <div class="ir-topic-name">
                                    {{ topic_result.topic_descr.topic.name }}
                                </div>
                            </td>
                        {% endif %}

                        <td{% if slot_result.is_penalty %} class="ir-penalty"{% endif %}>
                            {% with slot_result.problem_result as problem_result %}
                                {% if problem_result %}
                                    <div class="row">
                                        <div class="col-sm-8">
                                                <div>
                                                    {% irunner_problems_complexity problem_result.problem.complexity %}
                                                    <a href="{% url 'courses:course_problems_problem' course.id problem_result.problem.id %}">
                                                        {{ problem_result.problem.numbered_full_name }}
                                                    </a>
                                                </div>
                                                {% if problem_result.best_solution %}
                                                    <div class="ir-best-solution">
                                                        {% trans 'Best solution' %}: <a href="{% url 'solutions:main' problem_result.best_solution.id %}">{% irunner_solutions_scorebox problem_result.best_solution.best_judgement %}</a>
                                                    </div>
                                                {% endif %}
                                        </div>
                                        <div class="col-sm-4">
                                            {% for criterion_descr in slot_result.criterion_descrs %}
                                                <div>
                                                    {% irunner_courses_criterion criterion_descr.criterion criterion_descr.ok %}
                                                    {{ criterion_descr.criterion.name }}
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        </td>
                    </tr>
                {% endfor %}
            {% endwith %}
        {% endfor %}
    </tbody>
</table>

{% endblock %}
