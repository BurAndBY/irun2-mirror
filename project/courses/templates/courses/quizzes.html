{% extends 'courses/base.html' %}

{% load bootstrap3 %}
{% load i18n %}
{% load irunner_quizzes %}
{% load irunner_time %}

{% block subtitle %}{% trans 'Quizzes' %}{% endblock %}

{% block main %}

    {% if quizzes %}
        {% for quiz in quizzes %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    {{ quiz.instance.quiz_template.name }}
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-3">
                            <ul class="ir-quiz-info-list">
                                <li>{% irunner_timedelta_humanized quiz.instance.time_limit %}</li>
                                <li>{{ quiz.question_count }} questions</li>
                                {% if quiz.instance.is_available %}
                                    <li>{% if quiz.attempts_left == None %}Unlimited attempts{% else %}{{ quiz.attempts_left }} attempts left{% endif %}</li>
                                {% endif %}
                            </ul>
                        </div>
                        <div class="col-md-9 small">
                            {% if quiz.sessions %}
                                <table class="table table-condensed table-hover">
                                    <thead>
                                        <tr>
                                            <th>â„–</th>
                                            <th>{% trans 'Start time' %}</th>
                                            <th>{% trans 'Duration' %}</th>
                                            <th>{% trans 'Mark' %}</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for session in quiz.sessions %}
                                            <tr {% if not session.is_finished %} class="info" {% endif %}>
                                                <td>{{ forloop.counter }}</td>
                                                <td>{{ session.start_time }}</td>
                                                {% if session.is_finished %}
                                                    <td>{% irunner_timediff_hms session.start_time session.finish_time %}</td>
                                                    <td>{% irunner_quizzes_mark session.result %}</td>
                                                    {% if quiz.instance.show_answers %}
                                                        <td><a href="{% url 'courses:quizzes:answers' course.id session.id %}">{% trans 'Answers' %}</a></td>
                                                    {% else %}
                                                        <td class="text-muted">{% trans 'Not permitted to view answers' %}</td>
                                                    {% endif %}
                                                {% else %}
                                                    <td>&hellip;</td>
                                                    <td>{% irunner_quizzes_mark None %}</td>
                                                    <td>
                                                        <a href="{% url 'courses:quizzes:session' course.id session.id %}">{% trans 'Continue' %}</a>
                                                    </td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% endif %}
                            {% if not quiz.sessions and quiz.attempts_left == 1 %}
                                <div class="alert alert-danger" role="alert">
                                    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                                    <strong>{% trans 'Attention' %}!</strong>
                                    {% trans 'You can pass this quiz only once.' %}
                                </div>
                            {% endif %}

                            {% if permissions.quizzes_admin %}
                                <a class="btn btn-default btn-sm ir-quiz-inline-btn" href="{% url 'courses:quizzes:sheet' course.id quiz.instance.id %}">
                                    {% bootstrap_icon 'list-alt' %}
                                    <span class="ir-icon-label">{% trans 'Sheet' %}</span>
                                </a>
                            {% endif %}
                            {% if quiz.instance.attempts == 1 %}
                                <a class="btn btn-default btn-sm ir-quiz-inline-btn" href="{% url 'courses:quizzes:rating' course.id quiz.instance.id %}">
                                    {% bootstrap_icon 'sort-by-attributes-alt' %}
                                    <span class="ir-icon-label">{% trans 'Rating' %}</span>
                                </a>
                            {% endif %}
                            {% if quiz.can_start %}
                                <form method="post" action="{% url 'courses:quizzes:start' course.id quiz.instance.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-default btn-sm">
                                        <span class="glyphicon glyphicon-play"></span>
                                        <span class="ir-icon-label">{% trans 'Start quiz' %}</span>
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="ir-absence">{% trans 'No quizzes' %}</div>
    {% endif %}

{% endblock %}
